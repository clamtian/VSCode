# 1.分段机制


80386虚拟地址空间中的虚拟地址（逻辑地址）由一个段部分和一个偏移部分组成。**段**是虚拟地址到线性地址转换机制的基础。每个段由三个参数定义：

* 段基地址（Base Address），指定段在线型地址空间中的开始地址。基地址是线性地址，对应于段中偏移0处；
* 段限长（limit），是虚拟地址空间中段内最大可用偏移位置。它定义了段的长度。
* 段属性（Attributes），指定段的特性。例如该段是否可读、可写或者可以作为一个程序执行，还有段的特权级等。

## 1.1 段描述符

**段描述符**（Segment Descriptor）是x86架构中用来描述段的数据结构。段描述符包含了该段的基地址、段限长、段属性等信息，操作系统利用这些信息来管理和保护内存，以及提供多任务支持。在逻辑地址到线性地址的转换映射过程中会使用这个段描述符。

段描述符也称为全局描述符表项（Global Descriptor Table Entry，GDT Entry），存储在全局描述符表（Global Descriptor Table，GDT）或局部描述符表（Local Descriptor Table，LDT）中。在保护模式下，CPU可以通过段选择符（Segment Selector）在GDT或者LDT中选择相应的描述符。

为了把逻辑地址转换成一个线性地址，处理器会执行以下操作：

* 使用段选择符中的偏移值（段索引）在GDT或者LDT表中定位相应的段描述符（仅当一个新的段选择符加载到段寄存器中时才需要这一步）。
* 利用段描述符检验段的访问权限和范围，以确保该段是可访问的并且偏移量位于段界限内。
* 把段描述符中取得的段基地址加到偏移量上，最后形成一个线性地址。

![](./image/7_Segmentation.png)

## 1.2 段描述符表

段描述符表是段描述符的一个数组，描述符表的长度可变，最多可以包含8192个8字节描述符。有两种描述符表：全局描述符表GDT（Global Descriptor Table）和局部描述符表LDT（Local Descriptor Table）。

![](./image/8_DT.png)

















参考：
1. https://cloud.tencent.com/developer/article/1758806